rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check for an admin user
    function isAdmin() {
      return request.auth.token.admin === true;
    }

    // Videos: Readable by any logged-in user, writable only by admins
    match /videos/{videoId} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Categories: Readable by anyone, writable only by admins
    match /categories/{categoryId} {
        allow read: if true;
        allow write: if isAdmin();
    }

    // Users: A user can only read and write their own data.
    // No one else can see or modify their user document.
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Customers: A user can create their own customer document,
    // and can read or update it after creation.
    match /customers/{userId} {
      allow create, read, update: if request.auth != null && request.auth.uid == userId;
    }
  }
}
